{% extends "gas/base_gas.html" %}
{% load staticfiles %}

{% block style-block %}

{% endblock style-block %}

{% block sidebar-block %}
    {% with active_menu="dashboard" %}
        {{ block.super }}
    {% endwith %}
{% endblock sidebar-block %}

{% block page-header-block %}
<!-- Page Heading -->
<div id="div_breadcrumb" class="row">
    <div class="col-lg-12">
        <h1 class="page-header">
            Dashboard
        </h1>
        <ol class="breadcrumb">
            <li>
                <i class="fa fa-dashboard"></i> <a href="{% url 'dashboard' %}">In√≠cio</a>
            </li>
            <li class="active">
                <i class="fa fa-file"></i> Dashboard
            </li>
        </ol>
    </div>
</div>
{% endblock page-header-block %}

{% block container-fluid-block %}
    {% for gas_cylinder in object_list %}
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-bar-chart"></i> Cilindro: {{ gas_cylinder.pk }}</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-lg-2">
                            <svg id="fillgauge{{ gas_cylinder.pk }}" width="97%" height="100"></svg>
                        </div>
                        <div class="col-lg-2">
                            <i class="fa fa-search"></i> <a href="#">Detalhes</a>
                        </div>
                        <div class="col-lg-8">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% endblock container-fluid-block %}

{% block script-block %}

    <!-- D3.JS -->
    <script src="{% static "website/js/d3.v3.min.js" %}"></script>

    <!-- liquidFillGauge http://bl.ocks.org/brattonc/5e5ce9beee483220e2f6 -->
    <script src="{% static "website/js/liquidFillGauge.js" %}"></script>

    {% for gas_cylinder in object_list %}
    <!-- Ajax request for gas_cylinder {{ gas_cylinder.pk }}-->
    <script language="JavaScript">
        function plot_gauge(data){

            // TODO: Chance the looks
            var config = liquidFillGaugeDefaultSettings();

            config.circleThickness = 0.35;
            config.circleColor = "#6DA398";
            config.textColor = "#0E5144";
            config.waveTextColor = "#6DA398";
            config.waveColor = "#246D5F";
            config.textVertPosition = 0.52;
            config.waveAnimateTime = 5000;
            config.waveHeight = 0;
            config.waveAnimate = false;

            // level = Math.floor(Math.random() * 100); // Debug
            level = Math.floor(data.sensor_reading);
            var gauge1 = loadLiquidFillGauge("fillgauge{{ gas_cylinder.pk }}", level, config);
        }

        url_cylinder_weight = "{% url 'current-weight' channel=gas_cylinder.pk %}"

        $.ajax({
            dataType: "json",
            url: url_cylinder_weight,
            cache: false,
            success: plot_gauge
        });
    </script>
    {% endfor %}

{% endblock script-block %}
